<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">




<mapper namespace="org.easyway.mapper.sign.SignMapper">
	<cache />
	<insert id="insert">
		insert into sign(
				sign_id,sf_id,employee_id,sign_title,sign_content,sign_date
			)
			values (
				sign_seq.nextval,#{signFormId},1,#{signTitle},#{signContent},SYSDATE
			)
		<selectKey keyProperty="signId" resultType="long" order="AFTER">
         	select sign_seq.CURRVAL FROM DUAL
      	</selectKey>	
	</insert>
	
	<!-- 지출결의서 작성 -->
	<insert id="insertSpend">
		insert into si_spend(
				ss_id, sf_id, ss_range,ss_importance,sign_id
			)
			values (
				ss_seq.nextval,#{signFormId},#{signSpendRange},#{signSpendImportance},#{signId}
			)
	</insert>
	
	
	<!-- 휴가신청서 작성 -->
	<insert id="insertVacation">
		insert into si_vacation(
				sv_id, sf_id, sv_type, sv_start,sv_end, sign_id
			)
			values (
				sv_seq.nextval,#{signFormId},#{signVacationType},TO_DATE(#{signVacationStart},'yyyy/mm/dd')
				,TO_DATE(#{signVacationEnd},'yyyy/mm/dd'), #{signId}
			)
		
	</insert>
	
	<!-- 기본기안서 작성 -->
	<insert id="insertBasic" >
		insert into si_basic(
			sb_id, sf_id, sb_range, sb_start, sb_end,sb_importance, sign_id
		)
		values (
			si_basic_seq.nextval,#{signFormId},#{signBasicRange},TO_DATE(#{signBasicStart},'yyyy/mm/dd')
			,TO_DATE(#{signBasicEnd},'yyyy/mm/dd'),#{signBasicImportance}, #{signId}
		)
		
	</insert>
	

	
	<!-- 기안함 목록 -->
	<select id="getListDraft" resultType="org.easyway.domain.sign.SignVO">
		<![CDATA[
		select 
			sign_id AS signId,
			sf_id AS signFormId, 
			sign_title AS signTitle, 
			sign_content AS signContent,
			sign_check AS signCheck 
		from sign 
		where sign_id > 0
		]]>
	</select> 
	
	<select id="getListWithPaging" resultType="org.easyway.domain.sign.SignVO">
		<![CDATA[
		select 
			sign_id AS signId,
			sf_id AS signFormId, 
			sign_title AS signTitle, 
			sign_content AS signContent,
			sign_check AS signCheck 
		from
			(select /*INDEX_DESC(sign pk_sign) */
	    		rownum rn, sign_id, sf_id, sign_title, sign_content, sign_check
	    	from 
	    		sign
	    	where rownum <= 20)
		]]>
	</select>
	
	<select id="getDraftBasic" resultType="org.easyway.domain.sign.BasicSignVO">
		SELECT
			A.SIGN_TITLE AS signTitle, A.SIGN_CONTENT AS signContent,
			B.SB_RANGE AS signBasicRange,B.SB_START AS signBasicStart ,B.SB_END AS signBasicEnd ,B.SB_IMPORTANCE AS signBasicImportance,B.SIGN_ID AS signID, B.SF_ID AS signFormId
		FROM SIGN A
		JOIN SI_BASIC B
		ON 
			A.SIGN_ID = B.SIGN_ID
		WHERE 
			A.SIGN_ID = #{signId}	
	</select> 
	
	<select id="getDraftSpend" resultType="org.easyway.domain.sign.SpendSignVO">
		SELECT
			A.SIGN_TITLE AS signTitle, A.SIGN_CONTENT AS signContent,
			C.SS_RANGE AS signSpendRange,C.SS_IMPORTANCE AS signSpendImportance,C.SIGN_ID AS signId,C.SF_ID AS signFormId
		FROM SIGN A
		JOIN SI_SPEND C
		ON 
			A.SIGN_ID = C.SIGN_ID
		WHERE 
			A.SIGN_ID = #{signId}	
	</select> 
	
	<select id="getDraftVacation" resultType="org.easyway.domain.sign.VacationSignVO">
		SELECT
		A.SIGN_TITLE AS signTitle, A.SIGN_CONTENT AS signContent,
			D.SV_TYPE AS signVacationType, D.SV_START AS signVacationStart ,D.SV_END AS signVacationEnd ,D.SF_ID AS signFormId
		FROM SIGN A
		JOIN SI_VACATION D
		ON 
			A.SIGN_ID = D.SIGN_ID
		WHERE 
			A.SIGN_ID = #{signId}	
	</select> 
</mapper>
